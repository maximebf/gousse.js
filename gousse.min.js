(function(a){'function'==typeof define&&define.amd?define([],a):'object'==typeof exports&&'string'!=typeof exports.nodeName?module.exports=a():Object.assign(window,a())})(()=>{function on(a,b,c,d){if('function'==typeof b)d=c,c=b,b=a,a=document;else if(!(a instanceof Node))if(!a)a=document;else if('string'==typeof a)a=document.querySelector(a);else return void Object.entries(a).forEach(([j,l])=>on(j,l));let g,f=!0;const i=j=>{c(j),f&&d&&g(),f=!1};return g=()=>ensureArray(b).forEach(j=>a.removeEventListener(j,i)),ensureArray(b).forEach(j=>a.addEventListener(j,i)),g}function dispatch(a,b,c){let d=new CustomEvent(a,{detail:b,bubbles:!0});(c||document).dispatchEvent(d)}function emitter(a,b,c){return ensureArray(c||['change','keyup']).forEach(d=>{a.addEventListener(d,f=>dispatch('ValueEmitted',{name:b,value:f.target.value},a))}),a}function emitterContext(a,b){return Promise.resolve(b).then(c=>{return ensureArray(c).map(d=>{return d instanceof DocumentFragment?(emitterContext(a,d.childNodes),d):(d.addEventListener('ValueEmitted',f=>{f.stopPropagation(),a[f.detail.name]=f.detail.value}),d)})})}function ensureArray(a){return a instanceof NodeList?Array.prototype.slice.call(a,0):a&&!Array.isArray(a)?[a]:a}function appendNodes(a,b,c){a instanceof Node||(a=document.querySelector(a));for(let d of ensureArray(b))if(Array.isArray(d))appendNodes(a,d);else if(d instanceof Promise){let f=document.createComment('placeholder');appendNodes(a,f,c),d.then(g=>{appendNodes(a,g,f),a.removeChild(f)})}else d&&(d instanceof Node||(d=document.createTextNode(d)),c?a.insertBefore(d,c):a.appendChild(d))}function h(a,b,...c){let d=a;return'string'==typeof a?d=document.createElement(a):d.innerHTML='',b&&Object.entries(b).forEach(([f,g])=>{'emit'===f?emitter(d,g):'A'===d.tagName&&'go'===f?d.addEventListener('click',i=>{i.preventDefault(),router.go(g)}):f.match(/^on/)?d.addEventListener(f.substring(2),b[f]):d.setAttribute(f,b[f])}),'A'!==d.tagName||d.hasAttribute('href')||d.setAttribute('href','javascript:'),appendNodes(d,c),d}function connect(a,b,c,d){return new Promise(f=>{let i;const j=l=>{return Promise.resolve(l).then(m=>{m=ensureArray(m),i?(appendNodes(i[0].parentNode,m,i[0]),i.forEach(n=>n.parentNode.removeChild(n))):m&&f(m),i=m})};a instanceof Promise?a.then(l=>j(b(l))):Array.isArray(a)||'string'==typeof a?on(a,l=>j(b(l)),d):(d=!1,c=b,b=null,Object.entries(a).forEach(([l,m])=>on(l,n=>j(m(n))))),!0===c&&b?j(b()):!0!=c&&c&&j(c)})}function transformAttributeAnnotations(a,b,c){return ensureArray(a||document.body).forEach(d=>{Object.entries(attributeAnnotationTransformers).forEach(([f,g])=>{d.querySelectorAll(`[data-${f}]`).forEach(i=>g(i,b,c))})}),a}async function template(tpl,vars,...children){tpl='string'==typeof tpl?await ready(()=>document.getElementById(tpl)):await Promise.resolve(tpl);const root=document.importNode(tpl.content,!0);if(root.querySelectorAll('[data-var]').forEach(node=>{let value=vars[node.getAttribute('data-var')];'undefined'==typeof value||(node.hasAttribute('data-content')?node.innerText=(()=>eval('`'+node.getAttribute('data-content')+'`'))(value):node.innerText=value)}),children.length){const a=root.querySelector('slot');a&&(appendNodes(a.parentNode,children,a),a.parentNode.removeChild(a))}return Object.entries(vars).forEach(([a,b])=>{if(a.match(/^on/)){let c=a.substr(2),d=root.childNodes;'-1'!==c.indexOf(':')&&(d=root.querySelectorAll(c.substr(c.indexOf(':')+1)),c=c.substr(0,c.indexOf(':'))),d.forEach(f=>f.addEventListener(c,b))}}),root}function defineComponentElement(a,b){if(!('customElements'in window))return void console.error('Custom elements are not supported in this browser');class c extends HTMLElement{constructor(){super();this.attachShadow({mode:'open'});this.context=new ComponentContext(b,this)}render(){let d={};for(let g of this.getAttributeNames())d[g]=this.getAttribute(g);let f=Array.prototype.slice.call(this.childNodes,0);appendNodes(this.shadowRoot,this.context.render(d,f))}connectedCallback(){this.context.node=this.shadowRoot,this.render()}disconnectedCallback(){this.context.disconnected()}}return window.customElements.define(a,c),c}function component(a,b){return'function'==typeof a&&(b=a,a=null),a&&'customElements'in window?(defineComponentElement(a,b),(c,...d)=>h(a,c,...d)):async function(c,...d){const f=new ComponentContext(b);return await f.render(c,d),f.node=f.nodes[f.nodes.length-1],f.node.addEventListener('DOMNodeInsertedIntoDocument',()=>f.connected()),f.node.addEventListener('DOMNodeRemovedFromDocument',()=>f.disconnected()),f.nodes}}function ready(a){return new Promise(b=>{ready.dispatched?b(!a||a()):document.addEventListener('DOMContentLoaded',()=>b(!a||a()))})}function router(a){return connect('RouteChanged',()=>{for(let b of Object.keys(a)){let c=router.match(b,router.current.url);if(c)return a[b](...c,router.current.params,router.current.state)}if('404'in a)return a[404](router.current.params,router.current.state)},!0)}function App(a,b){ready(()=>{void 0!==b||a instanceof Node?a=a||document.body:(b=a,a=document.body),transformAttributeAnnotations(a),window.emittedValues={},emitterContext(window.emittedValues,a),'function'==typeof b?appendNodes(a,b(a)):Array.isArray(b)||b instanceof Node||b instanceof Promise?appendNodes(a,b):b&&on(b),dispatch('AppReady')})}const attributeAnnotationTransformers={dispatch:(node,rootNode,evalThisArg)=>{node.addEventListener(node.getAttribute('data-dispatch-event')||'click',()=>{let value=null;node.hasAttribute('data-dispatch-value')&&(value=function(){return eval('`'+node.getAttribute('data-dispatch-value')+'`')}.bind(evalThisArg)()),dispatch(node.getAttribute('data-dispatch'),value,rootNode)})},emit:a=>{emitter(a,a.getAttribute('data-emit'))},connect:(node,rootNode,evalThisArg)=>{let visibility=node.getAttribute('data-visibility')||'show';'hide'!==visibility&&node.classList.add('gousse-hide'),on(node.getAttribute('data-connect'),e=>{node.hasAttribute('data-content')&&(node.innerText=function(){return eval('`'+node.getAttribute('data-content')+'`')}.bind(evalThisArg)(e)),'hide'===visibility?node.classList.add('gousse-hide'):'toggle'===visibility?node.classList.toggle('gousse-hide'):node.classList.remove('gousse-hide')},!node.hasAttribute('data-content')&&!visibility)},emitted:(node,rootNode,evalThisArg)=>{on(rootNode,'ValueEmitted',e=>{e.detail.name===node.getAttribute('data-emitted')&&(node.hasAttribute('data-content')?node.innerText=function(){return eval('`'+node.getAttribute('data-content')+'`')}.bind(evalThisArg)(e.detail.value):node.innerText=e.detail.value)})},go:(node,rootNode,evalThisArg)=>{'A'===node.tagName&&(node.addEventListener('click',e=>{e.preventDefault(),router.go(function(){return eval('`'+node.getAttribute('data-go')+'`')}.bind(evalThisArg)())}),!node.hasAttribute('href')&&node.setAttribute('href','javascript:'))}},ComponentContext=class{constructor(a,b){this.renderCallback=a,this.eventDispatcher=b,this.connectCallbacks=[],this.disconnectCallbacks=[]}onconnect(a){this.node?a():this.connectCallbacks.push(a)}connected(){this.connectCallbacks.forEach(a=>requestAnimationFrame(a))}ondisconnect(a){this.disconnectCallbacks.push(a)}disconnected(){this.disconnectCallbacks.forEach(a=>a())}on(a,b,c){this.node?this.ondisconnect(on(a,b,c)):this.onconnect(()=>this.on(a,b,c))}dispatch(a,b,c){'string'==typeof a?(c=b,b=a):a&&a.stopPropagation(),dispatch(b,c,this.eventDispatcher||this.node)}emit(a,b){dispatch('ValueEmitted',{name:a,value:b},this.eventDispatcher||this.node)}async render(a,b){return this.nodes=await Promise.resolve(emitterContext(this,this.renderCallback.call(this,a,b,this))),transformAttributeAnnotations(this.nodes,this.shadowRoot,this)}querySelector(...a){return this.node.querySelector(...a)}querySelectorAll(...a){return this.node.querySelectorAll(...a)}};return router.match=function(a,b){b=b.replace(/\/$/,''),b=''===b?'/':b,'string'==typeof a&&(a=a.replace('/','\\/').replace('.','\\.').replace(/\{[^}]+\}/g,'([^/]+)'),a=new RegExp('^'+a+'$'));let d=b.match(a);return!!d&&d.slice(1)},router.usePushState=!1,router._hashchangeListener=()=>router.dispatch(window.location.hash.substr(1)),router._popstateListener=a=>router.dispatch(window.location.pathname+window.location.search,a?a.state:null),router.pushstate=function(){window.removeEventListener('hashchange',router._hashchangeListener),window.addEventListener('popstate',router._popstateListener),router.usePushState=!0,router._popstateListener(window.history)},router.parseQueryString=function(a){let b={};return a.split('&').forEach(c=>{let[d,f]=-1===c.indexOf('=')||c.split('=');b[d]=decodeURIComponent(f)}),b},router.buildQueryString=function(a){return Object.entries(a).map(([b,c])=>b+'='+encodeURIComponent(c)).join('&')},router.dispatch=function(a,b){let c={};a=''===a?'/':a,-1!==a.indexOf('?')&&(c=router.parseQueryString(a.substr(a.indexOf('?')+1)),a=a.substr(0,a.indexOf('?'))),router.current={url:a,state:b,params:c},dispatch('RouteChanged',router.current)},router.go=function(a,b,c){b&&(a+=(-1===a.indexOf('?')?'?':'&')+router.buildQueryString(b)),router.usePushState?(window.history.pushState(c||{},'',a),router._popstateListener({state:c})):window.location.hash=a},window.addEventListener('hashchange',router._hashchangeListener),document.addEventListener('DOMContentLoaded',()=>{ready.dispatched=!0}),router._hashchangeListener(),ready(()=>{const a=document.querySelector('.app-root');a&&App(a),'customElements'in window&&document.querySelectorAll('template[data-component]').forEach(b=>{component(b.getAttribute('data-component'),(c,d)=>{return template(b,c,...d)})}),document.querySelector('head').appendChild(h('style',{type:'text/css'},'.gousse-hide { display: none; }'))}),{on,dispatch,emitter,emitterContext,appendNodes,h,connect,fetchTemplate:async function(a,b){let c=await fetch(a,b),d=await c.text(),f=h('template',{id:a});return f.innerHTML=d,document.body.appendChild(f),f},template,component,ready,router,App}});
