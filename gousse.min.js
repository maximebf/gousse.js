(function(a){'function'==typeof define&&define.amd?define([],a):'object'==typeof exports&&'string'!=typeof exports.nodeName?module.exports=a():Object.assign(window,a())})(()=>{function on(a,b,c,d){if('function'==typeof b)d=c,c=b,b=a,a=document.body;else{if(a instanceof DocumentFragment)return void a.childNodes.forEach(j=>on(j,b,c,d));if(!(a instanceof Node))if(!a)a=document.body;else if('string'==typeof a)a=document.querySelector(a);else return void Object.entries(a).forEach(([j,l])=>on(j,l))}let g,f=!0;const i=j=>{c(j),f&&d&&g(),f=!1};return g=()=>ensureArray(b).forEach(j=>a.removeEventListener(j,i)),ensureArray(b).forEach(j=>a.addEventListener(j,i)),g}function dispatch(a,b,c){let d=new CustomEvent(a,{detail:b,bubbles:!0});(c||document.body).dispatchEvent(d)}function emitter(a,b,c){return ensureArray(c||['change','keyup']).forEach(d=>{on(a,d,f=>dispatch('ValueEmitted',{name:b,value:f.target.value},a))}),a}function emitterContext(a,b){return ensureArray(b).map(c=>{return on(c,'ValueEmitted',d=>{d.stopPropagation(),a[d.detail.name]=d.detail.value}),c})}function ensureArray(a){return a instanceof NodeList?Array.prototype.slice.call(a,0):a?Array.isArray(a)?a:[a]:[]}function appendNodes(a,b,c){a instanceof Node||(a=document.querySelector(a));let d=[];for(let f of ensureArray(b))if(Array.isArray(f))d=d.concat(appendNodes(a,f,c));else if(f instanceof Promise){let g=document.createComment('placeholder');d=d.concat(appendNodes(a,g,c)),f.then(i=>{appendNodes(a,i,g),a.removeChild(g)})}else f&&(f instanceof Node||f instanceof DocumentFragment||(f=document.createTextNode(f)),c?a.insertBefore(f,c):a.appendChild(f),d.push(f));return d}function h(a,b,...c){let d=a;return'string'==typeof a?d=document.createElement(a):d.innerHTML='',b&&Object.entries(b).forEach(([f,g])=>{'innerHTML'===f?Promise.resolve(g).then(i=>{d.innerHTML=i}):'emit'===f?emitter(d,g):'A'===d.tagName&&'go'===f?d.addEventListener('click',i=>{i.preventDefault(),router.go(g)}):f.match(/^on/)?d.addEventListener(f.substring(2),b[f]):d.setAttribute(f,b[f])}),'A'!==d.tagName||d.hasAttribute('href')||d.setAttribute('href','javascript:'),appendNodes(d,c),d}function connect(a,b,c,d){const f=h('div',{class:'gousse-connect'}),g=i=>{let j=b(i);j?h(f,{},j):!1===j&&(f.innerHTML='')};return a instanceof Promise?a.then(g):Array.isArray(a)||'string'==typeof a?on(a,g,d):(d=!1,c=b,b=null,Object.entries(a).forEach(([i,j])=>on(i,g))),!0===c&&b?g():c&&!0!==b&&appendNodes(f,c),f}function transformAttributeAnnotations(a,b,c){return ensureArray(a).forEach(d=>{Object.entries(attributeAnnotationTransformers).forEach(([f,g])=>{d.querySelectorAll(`[data-${f}]`).forEach(i=>g(i,b,c))})}),a}async function template(tpl,vars,...children){tpl='string'==typeof tpl?await ready(()=>document.getElementById(tpl)):await Promise.resolve(tpl);const root=document.importNode(tpl.content,!0);if(root.querySelectorAll('[data-var]').forEach(node=>{let value=vars[node.getAttribute('data-var')];'undefined'==typeof value||(node.hasAttribute('data-content')?node.innerText=(()=>eval('`'+node.getAttribute('data-content')+'`'))(value):node.innerText=value)}),children.length){const a=root.querySelector('slot');a&&(appendNodes(a.parentNode,children,a),a.parentNode.removeChild(a))}return Object.entries(vars).forEach(([a,b])=>{if(a.match(/^on/)){let c=a.substr(2),d=root.childNodes;'-1'!==c.indexOf(':')&&(d=root.querySelectorAll(c.substr(c.indexOf(':')+1)),c=c.substr(0,c.indexOf(':'))),d.forEach(f=>f.addEventListener(c,b))}}),root}function defineComponentElement(a,b){if(!('customElements'in window))return void console.error('Custom elements are not supported in this browser');class c extends HTMLElement{constructor(){super();this.attachShadow({mode:'open'});this.context=new ComponentContext(b,this,this.shadowRoot)}render(){let d={};for(let g of this.getAttributeNames())d[g]=this.getAttribute(g);let f=Array.prototype.slice.call(this.childNodes,0);appendNodes(this.shadowRoot,this.context.render(d,f))}connectedCallback(){this.render()}disconnectedCallback(){this.context.disconnected()}}return window.customElements.define(a,c),c}function component(a,b){return'function'==typeof a&&(b=a,a=null),a&&'customElements'in window?(defineComponentElement(a,b),(c,...d)=>h(a,c,...d)):async function(c,...d){const f=new ComponentContext(b);return await f.render(c,d),f.node.addEventListener('DOMNodeInsertedIntoDocument',()=>f.connected()),f.node.addEventListener('DOMNodeRemovedFromDocument',()=>f.disconnected()),f.nodes}}function ready(a){return new Promise(b=>{ready.dispatched?b(!a||a()):document.addEventListener('DOMContentLoaded',()=>b(!a||a()))})}function router(a,b){'string'==typeof a&&(a={[a]:b});let c;return connect('RouteChanged',()=>{for(let d of Object.keys(a)){let[f,g]=router.match(d,router.current.url);if(f)return g&&c&&c.url===d&&c.matches.toString()===f.toString()?void 0:(c={url:d,matches:f},a[d](...f,router.current.params,router.current.state))}return c=null,!!('404'in a)&&a[404](router.current.params,router.current.state)},!0)}function App(a,b){ready(()=>{void 0!==b||a instanceof Node?a=a||document.body:(b=a,a=document.body),transformAttributeAnnotations(a),window.emittedValues={},emitterContext(window.emittedValues,a),'function'==typeof b?appendNodes(a,b(a)):Array.isArray(b)||b instanceof Node||b instanceof Promise?appendNodes(a,b):b&&on(b),dispatch('AppReady')})}const attributeAnnotationTransformers={dispatch:(node,rootNode,evalThisArg)=>{on(node,node.getAttribute('data-dispatch-event')||'click',()=>{let value=null;node.hasAttribute('data-dispatch-value')&&(value=function(){return eval('`'+node.getAttribute('data-dispatch-value')+'`')}.bind(evalThisArg)()),dispatch(node.getAttribute('data-dispatch'),value,rootNode)})},emit:a=>{emitter(a,a.getAttribute('data-emit'))},connect:(node,rootNode,evalThisArg)=>{let visibility=node.getAttribute('data-visibility')||'show';'hide'!==visibility&&node.classList.add('gousse-hide'),on(node.getAttribute('data-connect'),e=>{node.hasAttribute('data-content')&&(node.innerText=function(){return eval('`'+node.getAttribute('data-content')+'`')}.bind(evalThisArg)(e)),'hide'===visibility?node.classList.add('gousse-hide'):'toggle'===visibility?node.classList.toggle('gousse-hide'):node.classList.remove('gousse-hide')},!node.hasAttribute('data-content')&&!visibility)},emitted:(node,rootNode,evalThisArg)=>{on(rootNode,'ValueEmitted',e=>{e.detail.name===node.getAttribute('data-emitted')&&(node.hasAttribute('data-content')?node.innerText=function(){return eval('`'+node.getAttribute('data-content')+'`')}.bind(evalThisArg)(e.detail.value):node.innerText=e.detail.value)})},go:(node,rootNode,evalThisArg)=>{'A'===node.tagName&&(on(node,'click',e=>{e.preventDefault(),router.go(function(){return eval('`'+node.getAttribute('data-go')+'`')}.bind(evalThisArg)())}),!node.hasAttribute('href')&&node.setAttribute('href','javascript:'))}},ComponentContext=class{constructor(a,b,c){this.renderCallback=a,this.eventDispatcher=b,this.rootNode=c,this.connectCallbacks=[],this.disconnectCallbacks=[]}onconnect(a){this.node?a():this.connectCallbacks.push(a)}connected(){this.connectCallbacks.forEach(a=>requestAnimationFrame(a))}ondisconnect(a){this.disconnectCallbacks.push(a)}disconnected(){this.disconnectCallbacks.forEach(a=>a())}on(a,b,c){this.node?this.ondisconnect(on(a,b,c)):this.onconnect(()=>this.on(a,b,c))}dispatch(a,b,c){'string'==typeof a?(c=b,b=a):a&&a.stopPropagation(),dispatch(b,c,this.eventDispatcher||this.node)}emit(a,b){dispatch('ValueEmitted',{name:a,value:b},this.eventDispatcher||this.node)}async render(a,b){let c=await this.renderCallback.call(this,a,b,this);return this.nodes=await Promise.all(ensureArray(c)),this.node=this.rootNode||this.nodes[this.nodes.length-1],emitterContext(this,this.nodes),Object.entries(a).forEach(([d,f])=>{d.match(/^on/)&&this.nodes.forEach(g=>on(g,d.substr(2),f))}),transformAttributeAnnotations(this.nodes,this.eventDispatcher,this)}querySelector(...a){return this.node.querySelector(...a)}querySelectorAll(...a){return this.node.querySelectorAll(...a)}};return router.match=function(a,b){let d;b=b.replace(/\/$/,''),b=''===b?'/':b,'string'==typeof a&&'^'!==a.substr(0,1)?(a=a.replace(/\//g,'\\/').replace(/\./g,'\\.').replace(/\{[^}*]+\}/g,'([^/]+)'),a.match(/\\\/\{?\*\}?$/)&&(d='*'===a.substr(a.length-1,1)?'.*':'(.*)',a=a.substr(0,a.length-3)+d),a=new RegExp('^'+a+'$','i')):'string'==typeof a&&'^'===a.substr(0,1)&&(a=new RegExp(a,'i'));let f=b.match(a);return[!!f&&f.slice(1),'.*'===d]},router.usePushState=!1,router._hashchangeListener=()=>router.dispatch(window.location.hash.substr(1)),router._popstateListener=a=>router.dispatch(window.location.pathname+window.location.search,a?a.state:null),router.pushstate=function(){window.removeEventListener('hashchange',router._hashchangeListener),window.addEventListener('popstate',router._popstateListener),window.addEventListener('hashchange',()=>dispatch('RouteHashChanged',window.location.hash.substr(1))),router.usePushState=!0,router._popstateListener(window.history)},router.parseQueryString=function(a){let b={};return a.split('&').forEach(c=>{let[d,f]=-1===c.indexOf('=')?[c,!0]:c.split('=');b[d]=decodeURIComponent(f)}),b},router.buildQueryString=function(a){return Object.entries(a).map(([b,c])=>b+'='+encodeURIComponent(c)).join('&')},router.dispatch=function(a,b){let c={};a=''===a?'/':a,-1!==a.indexOf('?')&&(c=router.parseQueryString(a.substr(a.indexOf('?')+1)),a=a.substr(0,a.indexOf('?'))),router.current={url:a,state:b,params:c},dispatch('RouteChanged',router.current)},router.go=function(a,b,c){a=a.replace(/\/\{?\*\}?$/,''),b&&Object.keys(b).length&&(Object.keys(b).forEach(d=>{-1!==a.indexOf(`{${d}}`)&&(a=a.replace(`{${d}}`,b[d]),delete b[d])}),a+=Object.keys(b).length?(-1===a.indexOf('?')?'?':'&')+router.buildQueryString(b):''),router.usePushState&&'#'!==a.substr(0,1)?(window.history.pushState(c||{},'',a),router._popstateListener({state:c})):window.location.hash='#'===a.substr(0,1)?a.substr(1):a},window.addEventListener('hashchange',router._hashchangeListener),document.addEventListener('DOMContentLoaded',()=>{ready.dispatched=!0}),ready(()=>{router._hashchangeListener();const a=document.querySelector('.app-root');a&&App(a),'customElements'in window&&document.querySelectorAll('template[data-component]').forEach(b=>{component(b.getAttribute('data-component'),(c,d)=>{return template(b,c,...d)})}),document.querySelector('head').appendChild(h('style',{type:'text/css'},`
        .gousse-hide { display: none; }
        .gousse-connect { display: inline-block; }
    `))}),{on,dispatch,emitter,emitterContext,appendNodes,h,connect,template,component,ready,router,App}});
